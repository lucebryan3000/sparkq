#!/usr/bin/env bash

# Load .env files
dotenv_if_exists .env
dotenv_if_exists .env.local

# Node version manager
use_nvm() {
  local node_version=$1
  if command -v nvm &>/dev/null; then
    nvm use "$node_version"
  elif command -v fnm &>/dev/null; then
    fnm use "$node_version"
  fi
}

# Load node version from .nvmrc
if [[ -f .nvmrc ]]; then
  use_nvm "$(cat .nvmrc)"
fi

# Python virtual environment
layout_python() {
  if [[ -d .venv ]]; then
    source .venv/bin/activate
  elif [[ -d venv ]]; then
    source venv/bin/activate
  fi
}

# Activate Python venv if present
if [[ -d .venv ]] || [[ -d venv ]]; then
  layout_python
fi

# Project-specific paths
export PATH="$PWD/node_modules/.bin:$PATH"
export PATH="$PWD/scripts:$PATH"

# Development environment
export NODE_ENV="${NODE_ENV:-development}"
export LOG_LEVEL="${LOG_LEVEL:-debug}"

# Disable telemetry
export NEXT_TELEMETRY_DISABLED=1
export DISABLE_TELEMETRY=1
export DO_NOT_TRACK=1

# Docker
export DOCKER_BUILDKIT=1
export COMPOSE_DOCKER_CLI_BUILD=1

# Timezone
export TZ="America/Chicago"
