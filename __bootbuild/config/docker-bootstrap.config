# ===================================================================
# docker-bootstrap.config
#
# Docker-Specific Bootstrap Configuration
# These values override bootstrap.config when running in Docker
# Automatically loaded when BOOTSTRAP_IN_DOCKER=true
#
# Usage:
#   This file is sourced by bootstrap-menu.sh if BOOTSTRAP_IN_DOCKER is detected
#   No manual action needed - auto-detection is built in
# ===================================================================

# ===================================================================
# Docker Detection & Mode Control
# ===================================================================

[docker]
# Auto-detect tier from BOOTSTRAP_TIER environment variable
auto_detect_tier=true

# Default tier if not specified (can be 1, 2, or 3)
default_tier=2

# Docker-specific network settings
host=0.0.0.0                    # Listen on all interfaces in container
bind_all_interfaces=true        # Required for Docker port mapping
expose_all_ports=true           # Allow Docker to manage ports

# Disable features that require interactive terminal
skip_interactive=true
auto_approve_all=true
skip_confirmations=true

# Logging configuration for containers
log_format=json                 # Use JSON for structured logging
log_to_stdout=true              # Log to stdout/stderr (Docker standard)
disable_colors=true             # ANSI colors don't work in container logs

# Skip host-specific validation checks
skip_docker_check=false         # Still verify we're in Docker
skip_port_availability_check=true  # Docker handles port conflicts

# Performance tuning
cache_bootstrap_results=true    # Cache phase outputs for faster rebuilds
parallel_bootstrap=true         # Run independent scripts in parallel

# ===================================================================
# TIER 1: Sandbox (Maximum Velocity)
# ===================================================================

[docker.tier1]
# Features
install_dev_tools=true
enable_debugging=true
enable_profiling=true
install_system_tools=true

# Configuration
skip_security_checks=true
allow_root_access=true
allow_host_network=true

# Performance
disable_resource_limits=true
disable_health_checks=true      # Faster startup for dev

# Logging
log_level=debug
enable_verbose_logging=true

# Bootstrap phases
run_phase_1=true                # AI Development Toolkit
run_phase_2=true                # Infrastructure
run_phase_3=true                # Code Quality
run_phase_4=true                # CI/CD & Deployment

# ===================================================================
# TIER 2: Development (Balanced)
# ===================================================================

[docker.tier2]
# Features
install_dev_tools=true
enable_debugging=true
enable_profiling=false          # Lighter than Tier 1
install_system_tools=true

# Configuration
skip_security_checks=false      # Basic security
enforce_user_mapping=true       # Map host user
enable_resource_limits=true

# Performance
max_cpus=4
max_memory_mb=4096
health_check_interval=30s

# Logging
log_level=info
enable_verbose_logging=false

# Bootstrap phases
run_phase_1=true                # AI Development Toolkit
run_phase_2=true                # Infrastructure
run_phase_3=true                # Code Quality
run_phase_4=false               # Skip CI/CD (not in container)

# ===================================================================
# TIER 3: Production (Hardened)
# ===================================================================

[docker.tier3]
# Features
install_dev_tools=false         # Minimal container size
enable_debugging=false          # No debug symbols
enable_profiling=false
install_system_tools=false      # Only runtime essentials

# Configuration
skip_security_checks=false      # Strict security
enforce_user_mapping=true       # Non-root user
enable_resource_limits=strict   # Strict limits

# Performance
max_cpus=2
max_memory_mb=2048
health_check_interval=30s
health_check_timeout=10s

# Logging
log_level=warn                  # Minimal logging in production
enable_verbose_logging=false
enable_json_logging=true        # Structured logging for log aggregation

# Filesystem
read_only_filesystem=true
tmpfs_enabled=true
tmpfs_size_mb=100

# Bootstrap phases
run_phase_1=true                # AI Development Toolkit (essentials only)
run_phase_2=false               # Skip Infrastructure (pre-configured)
run_phase_3=false               # Skip Code Quality (done in build)
run_phase_4=false               # Skip CI/CD (not in container)

# ===================================================================
# Environment Variable Handling
# ===================================================================

[docker.environment]
# When BOOTSTRAP_IN_DOCKER=true, these env vars are set automatically:
# BOOTSTRAP_MODE=docker
# BOOTSTRAP_NO_COLOR=true
# BOOTSTRAP_LOG_FORMAT=json
# BOOTSTRAP_INTERACTIVE_MODE=false
# BOOTSTRAP_AUTO_YES=true
# BOOTSTRAP_SKIP_PREFLIGHT=true

# Services network resolution
# When in Docker, service names (postgres, redis, etc.) resolve to container names
# No need to specify localhost - Docker DNS handles it

# ===================================================================
# Secrets Management
# ===================================================================

[docker.secrets]
# Docker secrets are available at /run/secrets/{secret_name}
# Bootstrap scripts can read them via get_docker_secret function
enable_secrets_support=true
secrets_dir=/run/secrets
prefer_docker_secrets=true      # Use Docker secrets over env vars

# Common secrets
supported_secrets=db_password,redis_password,app_secret,jwt_secret

# ===================================================================
# Container Startup Sequence
# ===================================================================

[docker.startup]
# Order of operations in entrypoint.sh
# 1. Detect environment (BOOTSTRAP_IN_DOCKER, BOOTSTRAP_TIER)
# 2. Setup environment variables
# 3. Configure services (Postgres, Redis, etc.)
# 4. Run bootstrap based on tier
# 5. Start application command

# Phase timing
max_bootstrap_time_seconds=300  # Timeout for entire bootstrap
max_service_wait_seconds=30     # Timeout waiting for services

# ===================================================================
# Health Checks
# ===================================================================

[docker.healthcheck]
# Tier 1: Disabled (fast startup)
# Tier 2: Enabled (moderate)
# Tier 3: Strict (production)

# Health check command (replaced by actual path)
# Tier 1: disabled
# Tier 2: curl -f http://localhost:3000/api/health
# Tier 3: node healthcheck.js

healthcheck_path=/healthcheck   # Default health endpoint
healthcheck_timeout_seconds=10
healthcheck_retries=3
healthcheck_interval_seconds=30
healthcheck_start_period_seconds=40
